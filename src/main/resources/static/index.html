<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pet Adoption System</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #74ebd5, #ACB6E5);
            display: flex;
            justify-content: center;
        }

        .container {
            width: 700px;
            margin-top: 40px;
            text-align: center;
        }

        h2 {
            margin-bottom: 20px;
        }

        input, button {
            padding: 8px;
            margin: 5px;
            border-radius: 6px;
            border: none;
        }

        button {
            cursor: pointer;
            background: #4CAF50;
            color: white;
        }

        button:hover {
            background: #45a049;
        }

        table {
            width: 100%;
            background: white;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        th, td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f2f2f2;
        }
    </style>
</head>

<body>

<div class="container">

    <h2>Pet Adoption System</h2>

    <h3>Add Pet</h3>

    <input id="name" placeholder="Name" pattern="[A-Za-z]+" title="Only letters allowed">
    <select id="type">
        <option value="Dog">Dog</option>
        <option value="Cat">Cat</option>
    </select>
    <input id="age" type="number" placeholder="Age">
    <button onclick="addPet()">Add</button>
    <p id="error" style="color:red;"></p>

    <h3>Search</h3>

    <input id="search" placeholder="Search by name" onkeyup="renderPets()">

    <h3>Pets List</h3>

    <button onclick="sortByName()">Sort by Name</button>
    <button onclick="sortByAge()">Sort by Age</button>

    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Type</th>
            <th>Name</th>
            <th>Age</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody id="petsTable"></tbody>
    </table>

</div>

<script>
    let pets = [];
    let sortMode = "";

    function loadPets() {
        fetch("/pets")
            .then(r => r.json())
            .then(data => {
                pets = data;
                renderPets();
            });
    }

    function renderPets() {
        let searchText = document.getElementById("search").value.toLowerCase();

        let filtered = pets.filter(p =>
            p.name.toLowerCase().includes(searchText)
        );

        if (sortMode === "name") filtered.sort((a, b) => a.name.localeCompare(b.name));
        if (sortMode === "age") filtered.sort((a, b) => a.age - b.age);

        let table = document.getElementById("petsTable");
        table.innerHTML = "";

        filtered.forEach(p => {
            table.innerHTML += `
            <tr id="row-${p.id}">
                <td>${p.id}</td>
                <td>${p.type}</td>
                <td>${p.name}</td>
                <td>${p.age}</td>
                <td>
                    <button onclick="editPet(${p.id})">Edit</button>
                    <button onclick="deletePet(${p.id})">Delete</button>
                </td>
            </tr>`;
        });
    }

    function editPet(id) {
        let pet = pets.find(p => p.id === id);

        document.getElementById(`row-${id}`).innerHTML = `
            <td>${pet.id}</td>
            <td>
                <select id="type-${id}">
                    <option ${pet.type === "Dog" ? "selected" : ""}>Dog</option>
                    <option ${pet.type === "Cat" ? "selected" : ""}>Cat</option>
                </select>
            </td>
            <td><input id="name-${id}" value="${pet.name}"></td>
            <td><input id="age-${id}" type="number" value="${pet.age}"></td>
            <td>
                <button onclick="savePet(${id})">Save</button>
                <button onclick="loadPets()">Cancel</button>
            </td>
        `;
    }

    function savePet(id) {
        let updatedPet = {
            name: document.getElementById(`name-${id}`).value,
            type: document.getElementById(`type-${id}`).value,
            age: parseInt(document.getElementById(`age-${id}`).value)
        };

        fetch("/pets/" + id, {
            method: "PUT",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(updatedPet)
        })
        .then(r => {
            if (!r.ok) return r.text().then(t => { throw new Error(t); });
            loadPets();
        })
        .catch(err => {
            alert(err.message);
        });
    }

    function addPet() {
        document.getElementById("error").innerText = "";

        let pet = {
            name: document.getElementById("name").value,
            type: document.getElementById("type").value,
            age: parseInt(document.getElementById("age").value)
        };

        fetch("/pets", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(pet)
        })
        .then(r => {
            if (!r.ok) return r.text().then(t => { throw new Error(t); });
            loadPets();
        })
        .catch(err => {
            document.getElementById("error").innerText = err.message;
        });
    }

    function deletePet(id) {
        fetch("/pets/" + id, { method: "DELETE" })
            .then(() => loadPets());
    }

    function sortByName() {
        sortMode = "name";
        loadPets();
    }

    function sortByAge() {
        sortMode = "age";
        loadPets();
    }

    loadPets();
</script>

</body>
</html>
